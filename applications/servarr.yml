apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: servarr
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: servarr
    server: https://kubernetes.default.svc
  project: default
  source:
    repoURL: https://github.com/fonzdm/servarr
    path: servarr
    targetRevision: servarr-1.0.2
    syncPolicy:
    automated:
      prune: false
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
    helm:
      values: |
        global:
          # -- (string) insert your prowlarr, sonarr, radarr api key here (one to rule them all!). do not remove the `&apikey` anchor!
          # @default -- no default value is configured for security reasons
          # @section -- global
          apikey: &apikey "yghshgz4cfmxoscvqtfooadm9pkxufbhyvlaigu1gcvobux57wcynrglhi7fbmat"
          # -- (string) insert your storage class here, e.g.: &storageclassname network-block. do not remove the `&storageclassname` anchor!
          # @section -- global
          storageclassname: &storageclassname "nfs-csi"
          # -- (string) insert your ingress class here, e.g.: &ingressclassname nginx. do not remove the `&ingresscassname` anchor, and do not leave the anchor value empty, otherwise you will face a `null` value error!
          # @default -- nginx
          # @section -- global
          ingressclassname: &ingressclassname "nginx"
          # -- (string) insert your cert manager cluster issuer, e.g.: letsencrypt-cloudflare. do not remove the `&issuer` anchor!
          # @default -- no default value, leave empty if not required
          # @section -- global
          certmanagerclusterissuer: &issuer "selfsigned-issuer"

        metrics:
          # -- anchor to set wether to deploy the export sidecar pods or not. requires the prometheus stack. do not remove the `&metricsenabled` anchor!
          # @section -- metrics
          enabled: &metricsenabled false 

        # @ignore
        initjellyseerr: true

        notifications:
          telegram:
            # -- enable the telegram notifications
            # @section -- jellyseerr
            enabled: false

        dash:
          # -- (string) insert the jellyfin username (will be used also for jellyseerr)
          # @section -- jellyfin
          # @default -- no default value
          username: root
          # -- (string) insert jellyfin password (will be used also for jellyseerr)
          # @section -- jellyfin
          # @default -- no default value
          password: wamui5vy4cxtfeck42dmdlxw
          # -- (string) insert jellyfin login mail (will be used also for jellyseerr integration)
          # @section -- jellyfin
          # @default -- no default value
          mail: "b.szulik@tuta.io"
          # -- (string) insert the jellyfin country code
          # @section -- jellyfin
          # @default -- us
          countrycode: "pl"
          # -- (string) insert the jellyfin preferred language
          # @section -- jellyfin
          # @default -- en
          preferredlanguage: "en"

        torrent:
          # -- (string) username of the qbittorrent admin user
          # @section -- torrent
          # @default -- no default value
          username: admin 
          # -- (string) password of the qbittorrent admin user. must be at least of 8 characters.
          # @section -- torrent
          # @default -- no default value
          password: adminadmin 

        # -- the indexers list. each element of the list is the yaml-formatted body of the [prowlarr api request](https://prowlarr.com/docs/api/#/indexer/post_api_v1_indexer) to add that index.
        # @default -- the body of the 1337x index is provided as default
        # @section -- prowlarr
        indexers:
          # @ignored
          - name: 1337x
            body:
              added: "0001-01-01t00:00:00z"
              appprofileid: 1
              capabilities:
                booksearchparams:
                  - q
                categories:
                  - id: 5000
                    name: tv
                    subcategories:
                      - id: 5070
                        name: tv/anime
                        subcategories: []
                      - id: 5040
                        name: tv/hd
                        subcategories: []
                      - id: 5030
                        name: tv/sd
                        subcategories: []
                      - id: 5080
                        name: tv/documentary
                        subcategories: []
                  - id: 3000
                    name: audio
                    subcategories:
                      - id: 3010
                        name: audio/mp3
                        subcategories: []
                      - id: 3040
                        name: audio/lossless
                        subcategories: []
                      - id: 3020
                        name: audio/video
                        subcategories: []
                      - id: 3050
                        name: audio/other
                        subcategories: []
                      - id: 3030
                        name: audio/audiobook
                        subcategories: []
                  - id: 2000
                    name: movies
                    subcategories:
                      - id: 2070
                        name: movies/dvd
                        subcategories: []
                      - id: 2030
                        name: movies/sd
                        subcategories: []
                      - id: 2010
                        name: movies/foreign
                        subcategories: []
                      - id: 2040
                        name: movies/hd
                        subcategories: []
                      - id: 2060
                        name: movies/3d
                        subcategories: []
                      - id: 2045
                        name: movies/uhd
                        subcategories: []
                  - id: 4000
                    name: pc
                    subcategories:
                      - id: 4030
                        name: pc/mac
                        subcategories: []
                      - id: 4070
                        name: pc/mobile-android
                        subcategories: []
                      - id: 4060
                        name: pc/mobile-ios
                        subcategories: []
                      - id: 4050
                        name: pc/games
                        subcategories: []
                      - id: 4040
                        name: pc/mobile-other
                        subcategories: []
                  - id: 1000
                    name: console
                    subcategories:
                      - id: 1080
                        name: console/ps3
                        subcategories: []
                      - id: 1020
                        name: console/psp
                        subcategories: []
                      - id: 1040
                        name: console/xbox
                        subcategories: []
                      - id: 1050
                        name: console/xbox 360
                        subcategories: []
                      - id: 1090
                        name: console/other
                        subcategories: []
                      - id: 1030
                        name: console/wii
                        subcategories: []
                      - id: 1010
                        name: console/nds
                        subcategories: []
                      - id: 1110
                        name: console/3ds
                        subcategories: []
                      - id: 1180
                        name: console/ps4
                        subcategories: []
                  - id: 6000
                    name: xxx
                    subcategories:
                      - id: 6010
                        name: xxx/dvd
                        subcategories: []
                      - id: 6060
                        name: xxx/imageset
                        subcategories: []
                  - id: 8000
                    name: other
                    subcategories:
                      - id: 8010
                        name: other/misc
                        subcategories: []
                  - id: 7000
                    name: books
                    subcategories:
                      - id: 7020
                        name: books/ebook
                        subcategories: []
                      - id: 7030
                        name: books/comics
                        subcategories: []
                limitsdefault: 100
                limitsmax: 100
                moviesearchparams:
                  - q
                musicsearchparams:
                  - q
                  - album
                  - artist
                searchparams:
                  - q
                  - q
                supportsrawsearch: true
                tvsearchparams:
                  - q
                  - season
                  - ep
              configcontract: cardigannsettings
              definitionname: 1337x
              description: 1337x is a public torrent site that offers verified torrent downloads
              downloadclientid: 0
              enable: true
              fields:
                - name: definitionfile
                  value: 1337x
                - name: baseurl
                  value: https://1337x.proxyninja.org/
                - name: basesettings.querylimit
                - name: basesettings.grablimit
                - name: basesettings.limitsunit
                  value: 0
                - name: torrentbasesettings.appminimumseeders
                - name: torrentbasesettings.seedratio
                - name: torrentbasesettings.seedtime
                - name: torrentbasesettings.packseedtime
                - name: downloadlink
                  value: 1
                - name: downloadlink2
                  value: 0
                - name: sort
                  value: 0
                - name: type
                  value: 1
              implementation: cardigann
              implementationname: cardigann
              indexerurls:
                - https://1337x.to/
                - https://1337x.st/
                - https://x1337x.ws/
                - https://x1337x.eu/
                - https://x1337x.se/
                - https://1337x.so/
                - https://1337x.unblockit.africa/
                - https://1337x.unblockninja.com/
                - https://1337x.ninjaproxy1.com/
                - https://1337x.proxyninja.org/
                - https://1337x.torrentbay.st/
              infolink: https://wiki.servarr.com/prowlarr/supported-indexers#1337x
              language: en-us
              legacyurls:
                - https://1337x.is/
                - https://1337x.gd/
                - https://1337x.nocensor.lol/
                - https://1337x.unblockit.ink/
                - https://1337x.nocensor.art/
                - https://1337x.unblockit.bio/
                - https://1337x.unblockit.boo/
                - https://1337x.mrunblock.guru/
                - https://1337x.mrunblock.life/
                - https://1337x.unblockit.click/
                - https://1337x.unblockit.asia/
                - https://1337x.unblockit.mov/
                - https://1337x.unblockit.rsvp/
                - https://1337x.unblockit.vegas/
                - https://1337x.unblockit.esq/
                - https://1337x.unblockit.zip/
                - https://1337x.unblockit.foo/
                - https://1337x.unblockit.ing/
                - https://1337x.mrunblock.bond/
                - https://1337x.unblockit.date/
                - https://1337x.unblockit.dad/
              name: 1337x
              priority: 25
              privacy: public
              protocol: torrent
              redirect: false
              sortname: 1337x
              supportspagination: false
              supportsredirect: false
              supportsrss: true
              supportssearch: true
              tags:
                - 1
          - name: ilcorsaroblu
            body:
              appprofileid: 1
              capabilities:
                booksearchparams:
                  - q
                categories:
                  - id: 6000
                    name: xxx
                    subcategories: []
                  - id: 4000
                    name: pc
                    subcategories:
                      - id: 4070
                        name: pc/mobile-android
                        subcategories: []
                      - id: 4060
                        name: pc/mobile-ios
                        subcategories: []
                      - id: 4010
                        name: pc/0day
                        subcategories: []
                      - id: 4030
                        name: pc/mac
                        subcategories: []
                      - id: 4050
                        name: pc/games
                        subcategories: []
                  - id: 7000
                    name: books
                    subcategories:
                      - id: 7020
                        name: books/ebook
                        subcategories: []
                      - id: 7030
                        name: books/comics
                        subcategories: []
                      - id: 7010
                        name: books/mags
                        subcategories: []
                  - id: 1000
                    name: console
                    subcategories:
                      - id: 1040
                        name: console/xbox
                        subcategories: []
                      - id: 1010
                        name: console/nds
                        subcategories: []
                  - id: 3000
                    name: audio
                    subcategories:
                      - id: 3010
                        name: audio/mp3
                        subcategories: []
                  - id: 2000
                    name: movies
                    subcategories:
                      - id: 2040
                        name: movies/hd
                        subcategories: []
                      - id: 2020
                        name: movies/other
                        subcategories: []
                      - id: 2070
                        name: movies/dvd
                        subcategories: []
                      - id: 2060
                        name: movies/3d
                        subcategories: []
                      - id: 2045
                        name: movies/uhd
                        subcategories: []
                  - id: 5000
                    name: tv
                    subcategories:
                      - id: 5030
                        name: tv/sd
                        subcategories: []
                      - id: 5040
                        name: tv/hd
                        subcategories: []
                      - id: 5070
                        name: tv/anime
                        subcategories: []
                      - id: 5060
                        name: tv/sport
                        subcategories: []
                      - id: 5080
                        name: tv/documentary
                        subcategories: []
                  - id: 8000
                    name: other
                    subcategories: []
                limitsdefault: 100
                limitsmax: 100
                moviesearchparams:
                  - q
                musicsearchparams:
                  - q
                searchparams:
                  - q
                  - q
                supportsrawsearch: false
                tvsearchparams:
                  - q
                  - season
                  - ep
              configcontract: cardigannsettings
              definitionname: ilcorsaroblu
              description: il corsaro blu is an italian semi-private site for tv / movies / general
              downloadclientid: 0
              enable: true
              fields:
                - name: definitionfile
                  value: ilcorsaroblu
                - name: baseurl
                  value: "https://ilcorsaroblu.org/"
                - name: basesettings.querylimit
                - name: basesettings.grablimit
                - name: basesettings.limitsunit
                  value: 0
                - name: torrentbasesettings.appminimumseeders
                - name: torrentbasesettings.seedratio
                - name: torrentbasesettings.seedtime
                - name: torrentbasesettings.packseedtime
                - name: username
                  value: ""
                - name: password
                  value: ""
                - name: freeleech
                  value: false
                - name: sort
                  value: 1
                - name: type
                  value: 1
              implementation: cardigann
              implementationname: cardigann
              indexerurls:
                - "https://ilcorsaroblu.org/"
              infolink: "https://wiki.servarr.com/prowlarr/supported-indexers#ilcorsaroblu"
              language: it-it
              legacyurls:
                - "http://ilcorsaroblu.org/"
                - "https://www.ilcorsaroblu.info/"
                - "https://www.ilcorsaroblu.org/"
                - "https://ilcorsaroblu.online/"
              name: il corsaro blu
              priority: 25
              privacy: semiprivate
              protocol: torrent
              redirect: false
              sortname: il corsaro blu
              supportspagination: false
              supportsredirect: false
              supportsrss: true
              supportssearch: true
              tags: []

        # -- for tracking purpose, not used - replaced with pre-existing cluster issuer
        # @section -- issuer
        # @default -- see the sub fields
        issuer:
          secretname: selfsigned-issuer
          # @section -- issuer
          ingressclassname: *ingressclassname

        volumes:
          # @ignore
          storageclass: *storageclassname
          # -- configuration of the volume used for torrent downloads
          # @section -- storage
          # @default -- see the sub fields
          downloads:
            # -- name of the download pvc. do not remove the `&downloads-volume` anchor!
            # @section -- storage
            name: &downloads-volume downloads-volume
            # -- size of the downloads volume, in kubernets format
            # @section -- storage
            size: 50gi
          # -- configuration of the volume used for media storage (i.e.: where movies and tv shows file will be permanently stored)
          # @section -- storage
          # @default -- see the sub fields
          media:
            # -- name of the media pvc. do not remove the `&media-volume` anchor!
            # @section -- storage
            name: &media-volume media-volume
            # -- size of the media volume, in kubernets format
            # @section -- storage
            size: 99gi 
          # -- configuration of the volume used for qbittorrent internal configuration
          # @section -- storage
          # @default -- see the sub fields
          torrentconfig:
            # -- name of the torrent configuration pvc. do not remove the `&torrentconfig` anchor!
            # @section -- storage
            name: &torrentconfig torrent-config
            # -- size of the torrent configuration volume, in kubernets format
            # @section -- storage
            size: 250mi

        # @ignore
        sonarr:
          # @ignore
          metrics:
            main:
              enabled: *metricsenabled
          # @ignore
          workload:
            main:
              podspec:
                containers:
                  main:
                    env:
                      sonarr__api_key: *apikey
          # @ignore
          ingress:
            # @ignore
            sonarr-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: sonarr.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - sonarr.katedra.kys
                  secretname: sonarr-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          # @ignore
          persistence:
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
            # @ignore
            media:
              enabled: true
              type: pvc
              existingclaim: *media-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/media
            # @ignore
            downloads:
              enabled: true
              type: pvc
              existingclaim: *downloads-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/downloads

        # @ignore
        radarr:
          # @ignore
          metrics:
            main:
              enabled: *metricsenabled
          # @ignore
          workload:
            main:
              podspec:
                containers:
                  main:
                    env:
                      radarr__api_key: *apikey
          # @ignore
          ingress:
            # @ignore
            radarr-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: radarr.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - radarr.katedra.kys
                  secretname: radarr-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          persistence:
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
            media:
              enabled: true
              type: pvc
              existingclaim: *media-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/media
            downloads:
              enabled: true
              type: pvc
              existingclaim: *downloads-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/downloads

        # @ignore
        jellyfin:
          metrics:
            main:
              enabled: *metricsenabled
          # @ignore
          fallbackdefaults:
            storageclass:
            probetype: http
            serviceprotocol: tcp
            servicetype: loadbalancer 
            persistencetype: pvc
            pvcretain: false
            pvcsize: 100gi
            vctsize: 100gi
            accessmodes:
              - readwritemany
            vctaccessmodes:
              - readwritemany
            probetimeouts:
              liveness:
                initialdelayseconds: 10
                periodseconds: 10
                timeoutseconds: 5
                failurethreshold: 5
                successthreshold: 1
              readiness:
                initialdelayseconds: 10
                periodseconds: 10
                timeoutseconds: 5
                failurethreshold: 5
                successthreshold: 2
              startup:
                initialdelayseconds: 10
                periodseconds: 5
                timeoutseconds: 2
                failurethreshold: 60
                successthreshold: 1
            pgversion: 16
          serviceprotocol: tcp
          ingress:
            jellyfin-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: jellyfin.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - jellyfin.katedra.kys
                  secretname: jellyfin-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          persistence:
            transcode:
              enabled: false
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
            media:
              enabled: true
              type: pvc
              existingclaim: *media-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/media

        # @ignore
        jellyseerr:
          metrics:
            main:
              enabled: *metricsenabled
          # @ignore
          fallbackdefaults:
            storageclass:
            probetype: http
            serviceprotocol: tcp
            servicetype: clusterip
            persistencetype: pvc
            pvcretain: false
            pvcsize: 100gi
            vctsize: 100gi
            accessmodes:
              - readwritemany
            vctaccessmodes:
              - readwritemany
            probetimeouts:
              liveness:
                initialdelayseconds: 10
                periodseconds: 10
                timeoutseconds: 5
                failurethreshold: 5
                successthreshold: 1
              readiness:
                initialdelayseconds: 10
                periodseconds: 10
                timeoutseconds: 5
                failurethreshold: 5
                successthreshold: 2
              startup:
                initialdelayseconds: 10
                periodseconds: 5
                timeoutseconds: 2
                failurethreshold: 60
                successthreshold: 1
            pgversion: 16
          ingress:
            jellyseerr-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: jellyseerr.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - jellyseerr.katedra.kys
                  secretname: jellyseerr-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          persistence:
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /app/config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
            media:
              enabled: true
              type: pvc
              existingclaim: *media-volume
              targetselector:
                main:
                  main:
                    mountpath: /mnt/media

        qbittorrent:
          # -- whether to enable or disable csrf protection on qbittorrent webgui
          # @section -- torrent
          # @default -- false
          csrf_protection: false
          # @ignore
          metrics:
            main:
              enabled: *metricsenabled
          # @ignore
          workload:
            main:
              podspec:
                containers:
                  main:
                    env:
                      qbittorrent__use_profile: true
          # @ignore
          ingress:
            qbittorrent-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: torrent.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - torrent.katedra.kys
                  secretname: torrent-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          # @ignore
          persistence:
            config:
              enabled: true
              type: pvc
              existingclaim: *torrentconfig
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
            downloads:
              enabled: true
              type: pvc
              existingclaim: *downloads-volume
              targetselector:
                main:
                  main:
                    mountpath: /downloads

        # @ignore
        prowlarr:
          metrics:
            main:
              enabled: *metricsenabled
          workload:
            main:
              podspec:
                containers:
                  main:
                    env:
                      prowlarr__api_key: *apikey
          ingress:
            prowlarr-ing:
              enabled: true
              primary: true
              required: true
              expandobjectname: false
              annotations:
                cert-manager.io/cluster-issuer: *issuer
              ingressclassname: *ingressclassname
              hosts:
                - host: prowlarr.katedra.kys
                  paths:
                    - path: /
                      pathtype: prefix
              tls:
                - hosts:
                    - prowlarr.katedra.kys
                  secretname: prowlarr-tls
              integrations:
                certmanager:
                  enabled: false
                traefik:
                  enabled: false
          persistence:
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true

        # @ignore
        flaresolverr:
          metrics:
            main:
              enabled: *metricsenabled
          persistence:
            config:
              enabled: true
              type: pvc
              size: 500mi
              accessmodes: readwritemany
              storageclass: *storageclassname
              targetselector:
                main:
                  main:
                    mountpath: /config
                exportarr:
                  exportarr:
                    mountpath: /config
                    readonly: true
